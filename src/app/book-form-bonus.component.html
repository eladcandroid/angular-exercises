<div class="container">
  <h1>ğŸ“š ××¢×¨×›×ª × ×™×”×•×œ ×¡×¤×¨×™×™×” - ×¤×ª×¨×•×Ÿ ×‘×•× ×•×¡ ××œ×</h1>
  <p class="subtitle">×˜×•×¤×¡ ×œ×”×•×¡×¤×ª ×¡×¤×¨ ×—×“×© ×¢× ×•×œ×™×“×¦×™×” ××¡×™× ×›×¨×•× ×™×ª</p>

  <!-- Bonus 2: Fill Example Button -->
  <div class="example-button-container">
    <button type="button" class="btn-example" (click)="fillExample()">
      âœ¨ ××œ× ×“×•×’××”
    </button>
  </div>

  <form [formGroup]="bookForm" (ngSubmit)="onSubmit()">

    <!-- Book Details Section -->
    <section class="form-section">
      <h2>ğŸ“– ×¤×¨×˜×™ ×”×¡×¤×¨</h2>

      <div class="form-group">
        <label for="title">×©× ×”×¡×¤×¨ *</label>
        <input
          type="text"
          id="title"
          formControlName="title"
          [class.is-invalid]="title?.invalid && title?.touched"
          [class.is-valid]="title?.valid && title?.touched"
        >

        <!-- Bonus 5: Word count -->
        @if (title?.value) {
          <div class="helper-text">
            ××¡×¤×¨ ××™×œ×™×: {{ titleWordCount }}
            @if (titleWordCount > 10) {
              <span class="warning">âš ï¸ ×”×›×•×ª×¨×ª ××¨×•×›×” ××“×™</span>
            }
          </div>
        }

        @if (title?.invalid && title?.touched) {
          <div class="error-message">
            @if (title?.errors?.['required']) {
              âš ï¸ ×©×“×” ×—×•×‘×”
            }
            @if (title?.errors?.['minlength']) {
              âš ï¸ ×©× ×”×¡×¤×¨ ×—×™×™×‘ ×œ×”×›×™×œ ×œ×¤×—×•×ª 2 ×ª×•×•×™×
            }
          </div>
        }
      </div>

      <div class="form-group">
        <label for="isbn">ISBN *</label>
        <input
          type="text"
          id="isbn"
          formControlName="isbn"
          placeholder="9781234567890"
          [class.is-invalid]="isbn?.invalid && isbn?.touched"
          [class.is-valid]="isbn?.valid && !isbn?.pending && isbn?.touched"
          [class.is-pending]="isbn?.pending"
        >

        <!-- Bonus 7: Async validation feedback -->
        @if (isbn?.pending) {
          <div class="pending-message">
            ğŸ” ×‘×•×“×§ ×–××™× ×•×ª ISBN...
          </div>
        }

        @if (isbn?.valid && !isbn?.pending && isbn?.touched) {
          <div class="success-message">
            âœ“ ISBN ×–××™×Ÿ
          </div>
        }

        @if (isbn?.invalid && isbn?.touched && !isbn?.pending) {
          <div class="error-message">
            @if (isbn?.errors?.['required']) {
              âš ï¸ ×©×“×” ×—×•×‘×”
            }
            @if (isbn?.errors?.['invalidIsbn']) {
              âš ï¸ ISBN ×—×™×™×‘ ×œ×”×›×™×œ ×‘×“×™×•×§ 13 ×¡×¤×¨×•×ª
            }
            @if (isbn?.errors?.['isbnExists']) {
              âš ï¸ ISBN ×–×” ×›×‘×¨ ×§×™×™× ×‘××¢×¨×›×ª ×”×¡×¤×¨×™×™×”
            }
          </div>
        }
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="publicationYear">×©× ×ª ×”×•×¦××” *</label>
          <input
            type="number"
            id="publicationYear"
            formControlName="publicationYear"
            [class.is-invalid]="publicationYear?.invalid && publicationYear?.touched"
            [class.is-valid]="publicationYear?.valid && publicationYear?.touched"
          >
          @if (publicationYear?.invalid && publicationYear?.touched) {
            <div class="error-message">
              @if (publicationYear?.errors?.['required']) {
                âš ï¸ ×©×“×” ×—×•×‘×”
              }
              @if (publicationYear?.errors?.['min'] || publicationYear?.errors?.['max']) {
                âš ï¸ ×©× ×ª ×”×•×¦××” ×—×™×™×‘×ª ×œ×”×™×•×ª ×‘×™×Ÿ 1800 ×œ-2025
              }
            </div>
          }
        </div>

        <div class="form-group">
          <label for="pageCount">××¡×¤×¨ ×¢××•×“×™× *</label>
          <input
            type="number"
            id="pageCount"
            formControlName="pageCount"
            [class.is-invalid]="pageCount?.invalid && pageCount?.touched"
            [class.is-valid]="pageCount?.valid && pageCount?.touched"
          >
          @if (pageCount?.invalid && pageCount?.touched) {
            <div class="error-message">
              @if (pageCount?.errors?.['required']) {
                âš ï¸ ×©×“×” ×—×•×‘×”
              }
              @if (pageCount?.errors?.['min']) {
                âš ï¸ ××¡×¤×¨ ×¢××•×“×™× ×—×™×™×‘ ×œ×”×™×•×ª ×œ×¤×—×•×ª 1
              }
            </div>
          }
        </div>
      </div>

      <div class="form-group">
        <label for="genre">×–'×× ×¨ *</label>
        <select
          id="genre"
          formControlName="genre"
          [class.is-invalid]="genre?.invalid && genre?.touched"
          [class.is-valid]="genre?.valid && genre?.touched"
        >
          <option value="">×‘×—×¨/×™ ×–'×× ×¨</option>
          <option value="Fiction">×‘×“×™×”</option>
          <option value="Non-Fiction">×¢×™×•×Ÿ</option>
          <option value="Science">××“×¢</option>
          <option value="History">×”×™×¡×˜×•×¨×™×”</option>
          <option value="Biography">×‘×™×•×’×¨×¤×™×”</option>
          <option value="Children">×™×œ×“×™×</option>
        </select>
        @if (genre?.invalid && genre?.touched) {
          <div class="error-message">
            âš ï¸ ×©×“×” ×—×•×‘×”
          </div>
        }
      </div>

      <!-- Bonus 1: Description field -->
      <div class="form-group">
        <label for="description">×ª×™××•×¨ ×”×¡×¤×¨</label>
        <textarea
          id="description"
          formControlName="description"
          rows="4"
          placeholder="×ª×™××•×¨ ×§×¦×¨ ×©×œ ×”×¡×¤×¨ (××•×¤×¦×™×•× ×œ×™)"
          [class.is-invalid]="description?.invalid && description?.touched"
          [class.is-valid]="description?.valid && description?.touched && description?.value"
        ></textarea>
        <div class="helper-text">
          {{ descriptionCharCount }}/500 ×ª×•×•×™×
        </div>
        @if (description?.invalid && description?.touched) {
          <div class="error-message">
            @if (description?.errors?.['maxlength']) {
              âš ï¸ ×”×ª×™××•×¨ ×™×›×•×œ ×œ×”×›×™×œ ×¢×“ 500 ×ª×•×•×™× ×‘×œ×‘×“
            }
          </div>
        }
      </div>
    </section>

    <!-- Publisher Section -->
    <section class="form-section" formGroupName="publisher">
      <h2>ğŸ¢ ×¤×¨×˜×™ ×”××•"×œ</h2>

      <div class="form-group">
        <label for="publisherName">×©× ×”××•"×œ *</label>
        <input
          type="text"
          id="publisherName"
          formControlName="name"
          [class.is-invalid]="publisherName?.invalid && publisherName?.touched"
          [class.is-valid]="publisherName?.valid && publisherName?.touched"
        >
        @if (publisherName?.invalid && publisherName?.touched) {
          <div class="error-message">âš ï¸ ×©×“×” ×—×•×‘×”</div>
        }
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="publisherCity">×¢×™×¨ *</label>
          <input
            type="text"
            id="publisherCity"
            formControlName="city"
            [class.is-invalid]="publisherCity?.invalid && publisherCity?.touched"
            [class.is-valid]="publisherCity?.valid && publisherCity?.touched"
          >
          @if (publisherCity?.invalid && publisherCity?.touched) {
            <div class="error-message">âš ï¸ ×©×“×” ×—×•×‘×”</div>
          }
        </div>

        <div class="form-group">
          <label for="publisherCountry">××“×™× ×” *</label>
          <input
            type="text"
            id="publisherCountry"
            formControlName="country"
            [class.is-invalid]="publisherCountry?.invalid && publisherCountry?.touched"
            [class.is-valid]="publisherCountry?.valid && publisherCountry?.touched"
          >
          @if (publisherCountry?.invalid && publisherCountry?.touched) {
            <div class="error-message">âš ï¸ ×©×“×” ×—×•×‘×”</div>
          }
        </div>
      </div>
    </section>

    <!-- Authors Section -->
    <section class="form-section">
      <h2>âœï¸ ××—×‘×¨×™×</h2>

      <div formArrayName="authors">
        @for (author of authors.controls; track $index) {
          <div class="author-card" [formGroupName]="$index">
            <div class="author-header">
              <h3>××—×‘×¨/×ª {{ $index + 1 }}</h3>
              @if (authors.length > 1) {
                <button
                  type="button"
                  class="btn-remove"
                  (click)="removeAuthor($index)"
                  title="×”×¡×¨ ××—×‘×¨/×ª"
                >
                  âœ•
                </button>
              }
            </div>

            <div class="form-group">
              <label [for]="'authorName' + $index">×©× ××œ× *</label>
              <input
                type="text"
                [id]="'authorName' + $index"
                formControlName="fullName"
                [class.is-invalid]="getAuthorControl($index, 'fullName')?.invalid && getAuthorControl($index, 'fullName')?.touched"
                [class.is-valid]="getAuthorControl($index, 'fullName')?.valid && getAuthorControl($index, 'fullName')?.touched"
              >
              @if (getAuthorControl($index, 'fullName')?.invalid && getAuthorControl($index, 'fullName')?.touched) {
                <div class="error-message">âš ï¸ ×©×“×” ×—×•×‘×”</div>
              }
            </div>

            <div class="form-group">
              <label [for]="'authorEmail' + $index">×“×•×"×œ *</label>
              <input
                type="email"
                [id]="'authorEmail' + $index"
                formControlName="email"
                [class.is-invalid]="getAuthorControl($index, 'email')?.invalid && getAuthorControl($index, 'email')?.touched"
                [class.is-valid]="getAuthorControl($index, 'email')?.valid && getAuthorControl($index, 'email')?.touched"
              >
              @if (getAuthorControl($index, 'email')?.invalid && getAuthorControl($index, 'email')?.touched) {
                <div class="error-message">
                  @if (getAuthorControl($index, 'email')?.errors?.['required']) {
                    âš ï¸ ×©×“×” ×—×•×‘×”
                  }
                  @if (getAuthorControl($index, 'email')?.errors?.['email']) {
                    âš ï¸ ×›×ª×•×‘×ª ×“×•×"×œ ×œ× ×ª×§×™× ×”
                  }
                </div>
              }
            </div>
          </div>
        }
      </div>

      <button type="button" class="btn-add" (click)="addAuthor()">
        â• ×”×•×¡×£ ××—×‘×¨/×ª
      </button>
    </section>

    <!-- Submit Button -->
    <div class="submit-section">
      <button
        type="submit"
        class="btn-submit"
        [disabled]="bookForm.invalid || bookForm.pending"
      >
        @if (bookForm.pending) {
          â³ ××××ª × ×ª×•× ×™×...
        } @else {
          ğŸ“š ×”×•×¡×£ ×¡×¤×¨ ×œ×¡×¤×¨×™×™×”
        }
      </button>
    </div>
  </form>

  <!-- Form Status Display -->
  <section class="status-section">
    <h2>ğŸ“Š ×¡×˜×˜×•×¡ ×”×˜×•×¤×¡</h2>
    <div class="status-grid">
      <div class="status-item">
        <strong>×¡×˜×˜×•×¡:</strong>
        <span [class.status-valid]="bookForm.valid" [class.status-invalid]="bookForm.invalid">
          {{ bookForm.valid ? 'VALID âœ“' : 'INVALID âœ—' }}
        </span>
      </div>
      <div class="status-item">
        <strong>××¦×‘:</strong>
        <span [class.status-pending]="bookForm.pending">
          {{ bookForm.pending ? 'PENDING â³' : 'READY âœ“' }}
        </span>
      </div>
      <div class="status-item">
        <strong>× ×’×•×¢:</strong>
        {{ bookForm.touched ? '×›×Ÿ' : '×œ×' }}
      </div>
      <div class="status-item">
        <strong>××¡×¤×¨ ××—×‘×¨×™×:</strong>
        {{ authors.length }}
      </div>
    </div>
  </section>

  <!-- Form Values Display -->
  <section class="json-section">
    <h2>ğŸ“„ ××™×“×¢ ×¢×œ ×”×¡×¤×¨ (JSON)</h2>
    <pre>{{ bookForm.value | json }}</pre>
  </section>

  <!-- Bonus 6: Books List -->
  @if (books.length > 0) {
    <section class="books-list-section">
      <h2>ğŸ“š ×¡×¤×¨×™× ×©× ×•×¡×¤×• ({{ books.length }})</h2>
      <div class="books-grid">
        @for (book of books; track $index) {
          <div class="book-item">
            <h3>{{ book.title }}</h3>
            <p class="book-genre">ğŸ·ï¸ {{ book.genre }}</p>
            <p class="book-authors">
              <strong>××—×‘×¨×™×:</strong>
              @for (author of book.authors; track $index) {
                {{ author.fullName }}@if ($index < book.authors.length - 1) {, }
              }
            </p>
            <p class="book-isbn"><strong>ISBN:</strong> {{ book.isbn }}</p>
          </div>
        }
      </div>
    </section>
  }
</div>
