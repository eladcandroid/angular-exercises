<div class="reviews-container">
  <div class="reviews-header">
    <h2>ביקורות לקוחות</h2>
    <span class="badge">✓ נטען בלחיצה! (Interaction Trigger + Idle Prefetch)</span>
  </div>

  <!-- Average Rating -->
  <div class="average-rating">
    <div class="rating-score">{{ averageRating() }}</div>
    <div class="rating-stars">
      @for (star of getStars(Math.round(averageRating())); track $index) {
        <span class="star">{{ star }}</span>
      }
      <span class="rating-count">({{ reviews().length }} ביקורות)</span>
    </div>
  </div>

  <!-- Reviews List -->
  <div class="reviews-list">
    <h3>כל הביקורות</h3>
    @for (review of reviews(); track review.id) {
      <div class="review-card">
        <div class="review-header">
          <div class="author-info">
            <div class="author-avatar">{{ review.author.charAt(0) }}</div>
            <div>
              <div class="author-name">{{ review.author }}</div>
              <div class="review-date">{{ review.date }}</div>
            </div>
          </div>
          <div class="review-rating">
            @for (star of getStars(review.rating); track $index) {
              <span class="star">{{ star }}</span>
            }
          </div>
        </div>
        <div class="review-content">
          {{ review.content }}
        </div>
      </div>
    }
  </div>

  <!-- Add Review Form -->
  <div class="add-review-section">
    <h3>הוסף/י ביקורת</h3>
    <form [formGroup]="reviewForm" (ngSubmit)="onSubmitReview()">
      <div class="form-group">
        <label for="author">שם מלא *</label>
        <input
          id="author"
          type="text"
          formControlName="author"
          placeholder="הכנס/י את שמך"
        >
        @if (reviewForm.get('author')?.invalid && reviewForm.get('author')?.touched) {
          <span class="error">שם חייב להכיל לפחות 2 תווים</span>
        }
      </div>

      <div class="form-group">
        <label for="rating">דירוג *</label>
        <select id="rating" formControlName="rating">
          <option value="5">⭐⭐⭐⭐⭐ מעולה</option>
          <option value="4">⭐⭐⭐⭐ טוב מאוד</option>
          <option value="3">⭐⭐⭐ בסדר</option>
          <option value="2">⭐⭐ פחות טוב</option>
          <option value="1">⭐ גרוע</option>
        </select>
      </div>

      <div class="form-group">
        <label for="content">תוכן הביקורת *</label>
        <textarea
          id="content"
          formControlName="content"
          placeholder="ספר/י לנו על החוויה שלך עם המוצר..."
          rows="4"
        ></textarea>
        @if (reviewForm.get('content')?.invalid && reviewForm.get('content')?.touched) {
          <span class="error">ביקורת חייבת להכיל לפחות 10 תווים</span>
        }
      </div>

      <button type="submit" [disabled]="reviewForm.invalid" class="submit-btn">
        פרסם/י ביקורת
      </button>
    </form>
  </div>
</div>
